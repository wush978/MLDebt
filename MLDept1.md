# 機器學習系統的技術債

D. Sculley等人在NIPS 2014發表了一篇很棒的非技術文章[@Sculley2014NIPS]，探討許多機器學習系統在實務上遇到的維護問題和解決方法。
恰好這三年來我也實作了一套推薦系統，文章中探討的雷也踩了不少，導致這陣子都在還債，讀來更有許多共鳴。
這篇文章，就以我親身經歷為例，探討[@Sculley2014NIPS]中的提出的觀點。

## 什麼是技術債？

在實務上，工程師常常因為時間壓力而必須在短時間內完成任務。
此時，工程師們會寫出未經完整思考和良好的設計的系統，導致未來維護系統時，必須要花更多的時間來重新整理這些趕出來的工作。

技術債是Ward Cunningham 在1992年提出的一種概念，泛指不良的系統設計、系統架構和程式碼品質對後續系統維護的難度和工作量所造成的衝擊。
這是一個很生動的比喻方法。

技術債和財務上的債務，有許多可以類比的地方。舉例來說，我們產生財務上的債務時，是要解決立即性的金錢需求，才透過借貸而產生債務。
這些債務並不是免費的，它們會一直產生利息。
而經過一段時間之後，我們總是要擠出金錢來把債務還清，否則就會導致債務越來越大，最終造成破產。

技術債之中，工程師為了要在短時間內完成產品，只好先略過糟糕的設計和程式碼，把任務完成再說。而後續在維護時，就必須面對當初留下的爛攤子。
舉例來說，有些工程師會透過大量的複製與貼上程式碼，或是把參數寫死來快速完成任務。
然而後續在修改功能時，就會發生漏改參數，或是漏改其中一份程式碼副本的狀況。
因此，工程師就需要花更多的時間來維護系統，而如果這些時間沒有解決問題，那僅止是在償還利息而已。
近代軟體工程講究利用重構(refactoring)、增加測試的覆蓋率、刪除不使用的程式碼、降低系統間的相依性、改良API的設計、改善文件等方法來克服技術債帶來的問題(請參考M. Fowler在1999的著作[@Fowler1999])。
這些動作不會為了系統帶來的新的功能，而是為了降低未來開發和維護的難度，償還過去所欠下的技術債。

## 機器學習系統

近年來由於數據科學的興起，企業們都希望建立數據產品來解決它們的問題。
機器學習系統是一種常見數據產品，例如現在各個網站均具備的推薦系統，就是一種機器學習系統。
那實際上的機器學習系統看起來像是怎樣呢？

以一個廣告推薦引擎系統為例，首先企業需要建立許多數據收集模組。
通常收集到的數據也很難直接利用，因此還要建立數據處理模組。
再來才能依據這些數據建立機器學習模組。
最後還要建立推薦模組，讓線上服務可以運用數據分析的成果。
從數據收集、數據處理、機器學習到推薦，這樣的架構在許多機器學習系統中都非常常見。

![推薦系統的架構](Recommendation.png)

## 機器學習系統與技術債

機器學習系統是由代碼建立而成的，所以**所有軟體工程上會遇到的問題，機器學習系統都會遇到**。
除此之外，機器學習系統還會對整體系統導入一種**系統層面的複雜度**，而這些系統層面的複雜度也會對未來的維護造成困難，所以在[@Sculley2014NIPS]之中也認為這是另一種技術債的來源。
為了清楚起見，以下我們就稱呼這類債務為**系統債**。

因此，機器學習系統也需要工程師利用重構或撰寫單元測試，來降低它的技術債。
但是這樣的動作沒辦法降低**系統層面的複雜度**，所以也沒辦法償還系統債。
以推薦引擎系統為例，機器學習系統的效果就會和數據收集、數據分析和推薦系統息息相關。
而這樣複雜的系統架構之下，技術債和系統債很容易產生並且累積。
如果我們僅僅是對各個模組撰寫單元測試，這樣的測試並沒辦法反應和控制數據收集模組對推薦模組的影響。

為了要增加推薦的精準度，資料收集模組也往往想要擴增更大量的資料源，這就導致大量的整合系統的程式碼(glue code)的產生。
而這也導致如果外在系統產生變化，這些變化產生資料的變化，跟著資料擴散至整個機器學習系統之中，對最後推薦的結果產生影響。
